<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações</title>
    <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <!-- IMPORTANTE: Ícones do Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-image: url("https://i.pinimg.com/originals/37/7c/41/377c4126c117b5053895c3537ed6678f.gif");
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            position: relative;
            overflow-x: hidden;
        }

        .wrapper{
            background: transparent;
            width:550px;
            padding: 40px;
            box-shadow: 0 0 10px rgba(0,0,0,.2);
            backdrop-filter: blur(20px);
            border-radius: 10px;
            margin-top: 60px;
        }

        .wrapper h1{
            font-size: 35px;
            text-align: center;
            color:white;
            margin-bottom: 20px;
            font-family:Arial, Helvetica, sans-serif;
        }

        .campo{
            width:100%;
            height:50px;
            margin: 20px 0;
            position:relative;
        }

        .campo input{
            padding:20px 45px 20px 20px;
            width:100%;
            height:100%;
            border:none;
            outline:none;
            border-radius: 40px;
            color:white;
            background:transparent;
            border: 2px solid white;
            font-size:16px;
            transition: all 0.3s ease;
        }

        .campo input:focus {
            border-color: #4ecca3;
            box-shadow: 0 0 8px rgba(78, 204, 163, 0.6);
        }

        .campo i{
            position:absolute;
            right:20px;
            top:17px;
            color: white;
            font-size: 18px;
        }

        .btn, .btnsair {
            width:100%;
            height:45px;
            border:none;
            outline:none;
            border-radius: 40px;
            font-size:16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .btn { color:darkgrey; background:white; }
        .btn:hover { background:#f0f0f0; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }

        .btnsair { color:#000; background:rgb(252, 39, 39); }
        .btnsair:hover { background:#f83838; transform: translateY(-2px); box-shadow:0 4px 8px rgb(226, 5, 5); }

        #divResposta { margin-top: 15px; text-align: center; font-weight: bold; color: white; }

        /* MENU LATERAL */
        .menu-btn {
            position: fixed; top: 20px; left: 20px; z-index: 1000;
            background: rgba(255,255,255,0.9); border: none; border-radius: 50%;
            width: 50px; height: 50px; font-size: 24px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); transition: all 0.3s ease;
        }
        .menu-btn:hover { background: white; transform: scale(1.05); }

        .sidebar {
            position: fixed; top: 0; left: -300px;
            width: 280px; height: 100%;
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            box-shadow: 2px 0 15px rgba(0,0,0,0.2); transition: all 0.3s ease;
            z-index: 999; padding-top: 80px; overflow-y: auto;
        }
        .sidebar.open { left: 0; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar a {
            display: flex; align-items: center;
            padding: 15px 25px; color: #333;
            text-decoration: none; border-bottom: 1px solid #eee;
            transition: all 0.3s ease; font-weight: 500;
        }
        .sidebar a:hover { background: #f8f9fa; color: #4ecca3; padding-left: 30px; }
        .sidebar i { margin-right: 15px; width: 20px; text-align: center; font-size: 20px; }

        .overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 998;
            opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        .overlay.open { opacity: 1; visibility: visible; }

        body.menu-open { overflow: hidden; }
    </style>
</head>
<body>

    <!-- Botão do menu -->
    <button class="menu-btn" id="menuBtn"><i class="fas fa-bars"></i></button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="index.html"><i class="fas fa-home"></i> Início</a></li>
            <li><a href="index.html" id="minhaLocalizacaoBtn"><i class="fas fa-location-arrow"></i> Minha Localização</a></li>
            <li><a href="config.html"><i class="fas fa-cog"></i> Configurações</a></li>
            <li><a href="login.html"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Conteúdo -->
    <div class="wrapper">
        <h1>Configurações</h1>

        <div class="campo">
            <input id="novoNome" type="text" placeholder="Editar nome de usuário" required>
            <i class='bx bxs-user'></i>
        </div>

        <div class="campo">
            <input id="novoEmail" type="email" placeholder="Editar email" required>
            <i class='bx bx-envelope'></i>
        </div>

        <div class="campo">
            <input id="novaSenha" type="password" placeholder="Editar senha" required>
            <i class='bx bxs-lock'></i>
        </div>

        <button type="button" class="btn" id="button">Concluir edição</button>
        <button type="button" class="btnsair" id="buttonexit">Encerrar sessão</button>

        <div id="divResposta"></div>
    </div>

    <script>
        const novoNome = document.getElementById("novoNome");
        const novoEmail = document.getElementById("novoEmail");
        const novaSenha = document.getElementById("novaSenha");
        const button = document.getElementById("button");
        const divResposta = document.getElementById("divResposta");

        // MENU
        const menuBtn = document.getElementById('menuBtn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const body = document.body;

        function toggleMenu() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
            body.classList.toggle('menu-open');
        }
        function closeMenu() {
            sidebar.classList.remove('open');
            overlay.classList.remove('open');
            body.classList.remove('menu-open');
        }

        menuBtn.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', closeMenu);
        document.querySelectorAll('.sidebar a').forEach(item => {
            item.addEventListener('click', closeMenu);
        });

        // PEGAR USUÁRIO
        const dadosLocalStorage = localStorage.getItem("dados");
        const objUsuario = JSON.parse(dadosLocalStorage);
        const idUsuario = objUsuario.usuario.IdUsuario;
        const token = objUsuario.token;

        // ATUALIZAR DADOS
        function atualizar_dados() {
            const URI = "http://localhost:8080/usuarios/" + idUsuario; 

            const corpo = {
                usuario: {
                    nome_usuario: novoNome.value,
                    email: novoEmail.value,
                    senha_usuario: novaSenha.value
                }
            };

            fetch(URI, {
                method: "PUT",
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify(corpo)
            })
            .then(res => res.json())
            .then(obj => {
                divResposta.textContent = obj.msg || "Dados atualizados com sucesso!";
                divResposta.style.color = obj.status === false ? "red" : "lime";
            })
            .catch(error => {
                console.error(error);
                divResposta.textContent = "Erro ao atualizar os dados.";
                divResposta.style.color = "red";
            });
        }

        button.addEventListener("click", function (e) {
            e.preventDefault();
            atualizar_dados();
        });
    </script>
</body>
</html>
